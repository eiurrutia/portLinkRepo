<!-- Barcode View -->
<div *ngIf="buttonTabActiveDicc['barcode']" style="z-index: inherit; overflow-y: scroll!important; height: 90%;">
  <ion-list class="main-list">
    <ion-item class="search-bar-item">
      <ion-searchbar animated
                show-cancel-button=true
                searchIcon="person"
                class="search-bar"
                [ngClass]="{'searchbar-green': correctSlectedDriver,
                            'searchbar-red': !correctSlectedDriver}"
                placeholder="Conductor Actual"
                (ionCancel)="searchBarActive = false"
                (ionFocus)="searchBarActive = true"
                (ionChange)="filterWithSearch(selectedDriver)"
                [(ngModel)]="selectedDriver">
      </ion-searchbar>
    </ion-item>
  <ion-list *ngIf=searchBarActive class="search-list">
    <ion-item *ngFor="let driver of driversFiltered" (click)="selectItem(driver)">
      {{ driver.nick }}
    </ion-item>
  </ion-list>
  <ion-list *ngIf=correctSlectedDriver class="search-list">
    <ion-item [ngClass]="{'search-vin-item-valid': correctVin == 2,
                          'search-vin-item-writing': correctVin == 1,
                          'search-vin-item-invalid': correctVin == 0}">
      <ion-grid>
        <ion-row>
          <ion-col size="4" style="text-align: right;">
            <ion-icon name="logo-model-s"></ion-icon>
          </ion-col>
          <ion-col size="4" style="text-align: center;">
            <ion-label position="center">VIN</ion-label>
          </ion-col>
          <ion-col size="2">
            <ion-icon name="logo-model-s"></ion-icon>
          </ion-col>
          <ion-col size="1" style="text-align: right;">
            <ion-icon name="information-circle"></ion-icon>
          </ion-col>
          <ion-col size="1" style="text-align: right;">
            <ion-icon name="settings"></ion-icon>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-input class="vin-input"
          [ngClass]="{'search-vin-item-valid': correctVin == 2,
                      'search-vin-item-writing': correctVin == 1,
                      'search-vin-item-invalid': correctVin == 0}"
          [(ngModel)]="vinToRegister"
          (ionChange)="correctVin = 1"
          (ionFocus)="correctVin = 1"
          (keyup.enter)="registerOrSearchUnit()" clearInput ></ion-input>
        </ion-row>
      </ion-grid>
    </ion-item>
    <ion-item>
      <ion-grid>
        <ion-row>
          <ion-col size="4">
          </ion-col>
          <ion-col size="4" style="text-align: center">
            Registro
          </ion-col>
          <ion-col size="4" style="text-align: right">
          </ion-col>
        </ion-row>
        <ion-row *ngIf="!correctVin">
          <ion-col style="text-align:center; color: red">
            "No se ha encontrado el VIN solicitado."
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="4">
            VIN:
          </ion-col>
          <ion-col size="8" style="text-align: right">
            {{ unitFound.vin ? unitFound.vin : '-' }}
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="4">
            Modelo:
          </ion-col>
          <ion-col size="8" style="text-align: right">
            {{ unitFound.model ? unitFound.model : '-' }}
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="4">
            Color:
          </ion-col>
          <ion-col size="8" style="text-align: right">
            {{ unitFound.color ? unitFound.color : '-' }}
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col size="4">
            Status:
          </ion-col>
          <ion-col *ngIf="!unitFound.model" size="8" style="text-align: right">
            -
          </ion-col>
          <ion-col *ngIf="unitFound.model" size="8"
          [ngClass]="{'status-green': unitFound.lapAssociated,
                      'status-red': !unitFound.lapAssociated}">
            {{ unitFound.lapAssociated ? 'Registrada' : 'No Registrada' }}
          </ion-col>
        </ion-row>
        <ion-row *ngIf="!unitFound.lapAssociated && correctVin == 2">
          <ion-col size="2">
          </ion-col>
          <ion-col size="10" style="text-align: right">
            Presione <b>Enter</b> nuevamente para <b>Registrar</b>.
          </ion-col>
        </ion-row>
        <ion-row *ngIf=unitFound.lapAssociated>
          <ion-col size="4">
            Conductor:
          </ion-col>
          <ion-col size="8" style="text-align: right">
            {{ unitFound?.lapAssociated?.driver?.name }}
          </ion-col>
        </ion-row>
        <ion-row *ngIf=unitFound.lapAssociated>
          <ion-col size="4">
            Vuelta:
          </ion-col>
          <ion-col size="8" style="text-align: right">
            {{ unitFound?.lapAssociated?.relativeNumber }}
          </ion-col>
        </ion-row>
        <ion-row *ngIf=unitFound.lapAssociated>
          <ion-col size="4">
            Fecha:
          </ion-col>
          <ion-col size="8" style="text-align: right">
            {{ getCleanDate(unitFound?.loadedDate, 'DD/MM/YYYY') }}
          </ion-col>
        </ion-row>
        <ion-row *ngIf=unitFound.lapAssociated>
          <ion-col size="4">
            Hora:
          </ion-col>
          <ion-col size="8" style="text-align: right">
            {{ getCleanDate(unitFound?.loadedDate, 'HH:mm') }}
            </ion-col>
        </ion-row>
        <ion-row *ngIf="unitFound.lapAssociated && correctVin == 2">
          <ion-col style="text-align: center;">
            <ion-button>
              <span style="font-size: smaller;">REINGRESAR</span>
            </ion-button>
          </ion-col>
        </ion-row>
        </ion-grid>
      </ion-item>
    </ion-list>
    <ion-grid>
      <ion-row>
        <ion-col size="6" no-padding>
          <ion-list *ngIf=correctSlectedDriver class="total-count">
            <ion-item no-padding class="general-count">
              <ion-grid>
                <ion-row style="margin-top: 2%;">
                  <ion-col style="text-align: center;">
                    Conteo Conductor
                  </ion-col>
                </ion-row>
                <ion-row style="margin-top: 2%;">
                  <ion-col size="5" style="text-align: left; font-size: small;">
                    Vuelta Actual:
                  </ion-col>
                  <ion-col size="7" style="text-align: center; font-size: x-large; align-self: center;">
                    <b> {{ currentLap ? currentLap.relativeNumber : '-' }} </b>
                  </ion-col>
                </ion-row>
                <ion-row style="margin-top: 2%;">
                  <ion-col size="6" style="text-align: left; font-size: small;">
                    Unidades Cargadas:
                  </ion-col>
                  <ion-col size="6" style="text-align: center; font-size: x-large;
                                           align-self: center; color: green;">
                    <b> {{ currentLap ? currentLap?.load?.length : '-' }} </b>
                  </ion-col>
                </ion-row>
                <ion-row style="margin-top: 2%;">
                  <ion-col size="4" style="text-align: left; font-size: small;">
                    Última carga:
                  </ion-col>
                  <ion-col size="8" style="text-align: center; font-size: small; align-self: center;">
                    {{ currentLap ? 'Hace ' + lastLoadText : '-' }}
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-item>
          </ion-list>
        </ion-col>
        <ion-col size="6" no-padding>
          <ion-list *ngIf=correctSlectedDriver class="total-count">
            <ion-item no-padding class="general-count">
              <ion-grid>
                <ion-row style="margin-top: 2%;">
                  <ion-col style="text-align: center;">
                    Conteo General
                  </ion-col>
                </ion-row>
                <ion-row style="margin-top: 2%;">
                  <ion-col size="5" style="align-self: center;">
                    Total:
                  </ion-col>
                  <ion-col size="7" style="text-align: center; font-size: x-large; align-self: center;">
                    <b> {{ currentPort.unitsInPacking.totalQuantity }} </b>
                  </ion-col>
                </ion-row>
                <ion-row style="margin-top: 2%;">
                  <ion-col size="6" style="text-align: center; font-size: small;">
                    Retirado
                  </ion-col>
                  <ion-col size="6" style="text-align: center; font-size: small;">
                    Por retirar
                  </ion-col>
                </ion-row>
                <ion-row style="margin-top: 2%;">
                  <ion-col size="6" style="text-align: center; font-size: large; color: green; align-self: center;">
                    <b> {{ currentPort.collectedUnits.totalQuantity }} </b>
                  </ion-col>
                  <ion-col size="6" style="text-align: center; font-size: large; color: red; align-self: center;">
                    <b> {{ currentPort.unitsInPacking.totalQuantity - currentPort.collectedUnits.totalQuantity }} </b>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-item>
          </ion-list>
        </ion-col>
      </ion-row>
    </ion-grid>

  </ion-list>
</div>

<!-- Resume View -->
<div *ngIf="buttonTabActiveDicc['resume']" style="z-index: inherit;">
  <ion-list class="main-list resume-list">
    <ion-item>
      <ion-grid no-padding>
        <ion-row style="margin-top: 2%;">
          <ion-col size="5" style="align-self: center; font-size: x-large;">
            Total:
          </ion-col>
          <ion-col size="7" style="text-align: center; font-size: x-large; align-self: center;">
            {{ currentPort.unitsInPacking.totalQuantity }}
          </ion-col>
        </ion-row>
        <ion-row style="margin-top: 2%;">
          <ion-col size="3.5" style="align-self: center;">
            Retirado:
          </ion-col>
          <ion-col size="2.5" style="text-align: center; font-size: x-large; align-self: center; color: green;">
            {{ currentPort.collectedUnits.totalQuantity }}
          </ion-col>
          <ion-col size="3.5" style="align-self: center;">
            Por retirar:
          </ion-col>
          <ion-col size="2.5" style="text-align: center; font-size: x-large; align-self: center; color: red;">
            {{ currentPort.unitsInPacking.totalQuantity - currentPort.collectedUnits.totalQuantity }}
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-item>
    <ion-item>
      <ion-grid>
        <ion-row style="margin-top: 2%;">
          <ion-col>
            Tamaños
          </ion-col>
        </ion-row>
        <ion-row *ngIf="currentPort.unitsInPacking.smallQuantity != 0" style="margin-top: 2%;">
          <ion-col size="4" style="text-align: right; align-self: center;">
            Pequeñas:
          </ion-col>
          <ion-col size="4" style="text-align: center; font-size: x-large; align-self: center;">
            {{ currentPort.unitsInPacking.smallQuantity }}
          </ion-col>
          <ion-col size="2" style="text-align: center; font-size: medium; align-self: center; color: green;">
            {{ currentPort.collectedUnits.smallQuantity }}
          </ion-col>
          <ion-col size="2" style="text-align: center; font-size: medium; align-self: center; color: red;">
            {{ currentPort.unitsInPacking.smallQuantity - currentPort.collectedUnits.smallQuantity }}
          </ion-col>
        </ion-row>
        <ion-row *ngIf="currentPort.unitsInPacking.mediumQuantity != 0" style="margin-top: 2%;">
          <ion-col size="4" style="text-align: right; align-self: center;">
            Medianas:
          </ion-col>
          <ion-col size="4" style="text-align: center; font-size: x-large; align-self: center;">
            {{ currentPort.unitsInPacking.mediumQuantity }}
          </ion-col>
          <ion-col size="2" style="text-align: center; font-size: medium; align-self: center; color: green;">
            {{ currentPort.collectedUnits.mediumQuantity }}
          </ion-col>
          <ion-col size="2" style="text-align: center; font-size: medium; align-self: center; color: red;">
            {{ currentPort.unitsInPacking.mediumQuantity - currentPort.collectedUnits.mediumQuantity }}
          </ion-col>
        </ion-row>
        <ion-row *ngIf="currentPort.unitsInPacking.bigQuantity != 0" style="margin-top: 2%;">
          <ion-col size="4" style="text-align: right; align-self: center;">
            Grandes:
          </ion-col>
          <ion-col size="4" style="text-align: center; font-size: x-large; align-self: center;">
            {{ currentPort.unitsInPacking.bigQuantity }}
          </ion-col>
          <ion-col size="2" style="text-align: center; font-size: medium; align-self: center; color: green;">
            {{ currentPort.collectedUnits.bigQuantity }}
          </ion-col>
          <ion-col size="2" style="text-align: center; font-size: medium; align-self: center; color: red;">
            {{ currentPort.unitsInPacking.bigQuantity - currentPort.collectedUnits.bigQuantity }}
          </ion-col>
        </ion-row>
        <ion-row *ngIf="currentPort.unitsInPacking.extraQuantity != 0" style="margin-top: 2%;">
          <ion-col size="4" style="text-align: right; align-self: center;">
            Extra:
          </ion-col>
          <ion-col size="4" style="text-align: center; font-size: x-large; align-self: center;">
            {{ currentPort.unitsInPacking.extraQuantity }}
          </ion-col>
          <ion-col size="2" style="text-align: center; font-size: medium; align-self: center; color: green;">
            {{ currentPort.collectedUnits.extraQuantity }}
          </ion-col>
          <ion-col size="2" style="text-align: center; font-size: medium; align-self: center; color: red;">
            {{ currentPort.unitsInPacking.extraQuantity - currentPort.collectedUnits.extraQuantity }}
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-item>
    <ion-item>
      <ion-grid>
        <ion-row style="margin-top: 2%;">
          <ion-col>
            Modelos
          </ion-col>
        </ion-row>
        <ion-row *ngFor="let item of currentPort.modelsCountDicc.totalToCollect | keyvalue" style="margin-top: 2%;">
          <ion-col size="4" style="text-align: right; align-self: center;">
            {{ item.key }}
          </ion-col>
          <ion-col size="4" style="text-align: center; font-size: x-large; align-self: center;">
            {{ item.value }}
          </ion-col>
          <ion-col size="2" style="text-align: center; font-size: medium; align-self: center; color: green;">
            {{ currentPort.modelsCountDicc.collected[item.key] }}
          </ion-col>
          <ion-col size="2" style="text-align: center; font-size: medium; align-self: center; color: red;">
            {{ item.value - currentPort.modelsCountDicc.collected[item.key] }}
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-item>
    <ion-item *ngIf="currentPort.doneLaps">
      <ion-grid>
        <ion-row style="margin-top: 2%;">
          <ion-col size="5" style="align-self: center; font-size: large;">
            Total Vueltas:
          </ion-col>
          <ion-col size="7" style="text-align: center; font-size: large; align-self: center;">
            {{ currentPort.doneLaps }}
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-item>
  </ion-list>
</div>


<!-- Packing View -->
<div *ngIf="buttonTabActiveDicc['packing']" style="z-index: inherit;">
  <ion-list class="main-list resume-list">
    <ion-item style="padding-bottom: 4%;">
      <ion-searchbar animated style="padding-bottom: 2%;"
                show-cancel-button=true
                searchIcon="search"
                class="search-bar"
                placeholder="Buscar"
                (change)="searchInPacking()"
                [(ngModel)]="wordSearchedInPacking">
      </ion-searchbar>
    </ion-item>
    <ion-item class="preview">
      <ion-content scrollY="true">
        <ion-grid>
          <ion-row>
            <ion-col size="5" no-padding>
              <ion-grid style="height: auto; font-size:0.8em; font-weight:700;" no-padding>
                <ion-row class="header-row" nowrap style="padding: 0;">
                  <ion-col size="12" class="preview-col header-row" style="padding: 0;" nowrap>
                    vin
                  </ion-col>
                </ion-row>
                <ion-row class="info-row" *ngFor="let model of unitsList" nowrap style="padding: 0;">
                  <ion-col size="12" class="preview-col info-row" style="padding: 0;"  nowrap>
                    {{ model['vin'] }}
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-col>
            <ion-col size="7" no-padding>
              <ion-grid class="forecast_container" no-padding>
                <ion-row class="header-row" nowrap style="padding: 0;">
                  <ion-col size="6" class="preview-col header-row" *ngFor="let header of packingListHeaders" no-padding nowrap>
                    {{ header }}
                  </ion-col>
                </ion-row>
                <ion-row class="info-row" *ngFor="let model of unitsList" nowrap style="padding: 0;">
                  <ion-col size="6" class="preview-col info-row" *ngFor="let header of packingListHeaders" no-padding nowrap>
                    {{ model[header] }}
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-col>
          </ion-row>
        </ion-grid>
      </ion-content>
    </ion-item>
  </ion-list>
</div>


<ion-tabs style="overflow-y: scroll!important;">
  <ion-tab-bar slot="bottom">
    <ion-tab-button [ngClass]="{'tab-button-active': buttonTabActiveDicc['barcode'],
                                'tab-button-inactive': !buttonTabActiveDicc['barcode']}"
                    (click)="changeTabButton('barcode')">
      <ion-icon name="barcode"></ion-icon>
      <ion-label>Registrar</ion-label>
      <ion-badge *ngIf="currentLap" style="background: red; font-size: unset;">{{ currentLap?.load?.length }}</ion-badge>
    </ion-tab-button>

    <ion-tab-button [ngClass]="{'tab-button-active': buttonTabActiveDicc['resume'],
                                'tab-button-inactive': !buttonTabActiveDicc['resume']}"
                    (click)="changeTabButton('resume')">
      <ion-icon name="clipboard"></ion-icon>
      <ion-label>Resumen</ion-label>
    </ion-tab-button>

    <ion-tab-button [ngClass]="{'tab-button-active': buttonTabActiveDicc['packing'],
                                'tab-button-inactive': !buttonTabActiveDicc['packing']}"
                    (click)="changeTabButton('packing')">
      <ion-icon name="paper"></ion-icon>
      <ion-label>Packing</ion-label>
    </ion-tab-button>

    <ion-tab-button  [ngClass]="{'tab-button-active': buttonTabActiveDicc['share'],
                                'tab-button-inactive': !buttonTabActiveDicc['share']}"
                    (click)="changeTabButton('share')">
      <ion-icon name="share"></ion-icon>
      <ion-label>Compartir Info.</ion-label>
    </ion-tab-button>
  </ion-tab-bar>
</ion-tabs>
